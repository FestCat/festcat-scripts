#!/bin/bash
# text2audio: Converteix un arxiu de text a un format d'audio llegint-lo amb Festival, afegint el nom de l'arxiu a l'etiqueta mp3 del títol, i opcionalment l'autor
# Ús: bash text2audio.sh arxiu.txt [autor [pista]]
# Escrit per Paco Rivière http://pacoriviere.cat - Juny 2008 - Per a Ubuntu Hardy 8.04 - Llicència GNU\GPL
# Modificat per Sergio Oller sergioller@gmail.com Agost 2011
# Aquest script està escrit suposant que tenim la veu catalana triada per omissió:
# https://wiki.ubuntu.com/CatalanTeam/Tutorials/S%c3%adntesiDeVeu/Scripts

DATADIR="__DATADIR__"
. "${DATADIR}/docfunctions"
usage=usage_festcat_llegeix
init_entorn # incialitza variables

#Constants
voice="$DEFAULT_VOICE"
verbose=0

while getopts "hv:V" option;
do
   case "$option" in
      h) $usage
         exit 0
         ;;
      v)
         voice="$OPTARG"
         ;;
      V)
         verbose=$(expr $verbose + 1)
         ;;
    [?]) 
         $usage
         exit ;;
   esac
done
shift $(($OPTIND - 1)) 

# L'argument que queda és el pressumpte fitxer de text a llegir:
if [ $# = 0 ]; then
   echo "$0: Cal indicar un fitxer de text."
   $usage
   exit 1
fi
infile="$1"
es_textfile "$infile" # Comprovem que és un fitxer de text
echoverb "El fitxer «$infile» és de text" 0

# Comprovem que la veu triada existeix (i sinó posem una per defecte):
voice_exists "$voice" || voice="${DEFAULT_VOICE}"
echoverb "Parlem amb la veu de: «$voice»" 0

text=$(clean_file "${infile}")
echoverb "Text a llegir: «$voice»" 1

llegeix "$voice" "$text" 


